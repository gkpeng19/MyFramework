@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row-fluid">
    <div class="dataTables_wrapper">
        <div class="row-fluid">
            <div class="span12">
                <div class="dataTables_length">
                    <button class="btn btn-primary btn-small btn-table-add">新 增</button>
                </div>
            </div>
        </div>
        <table id="5276602330016288" class=" table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th data-option="{sequence:true}">序号</th>
                    <th data-option="{bind:'UserName'}">用户名</th>
                    <th data-option="{bind:'UserRole_G'}">角 色</th>
                    <th data-option="{bind:'Email'}">Email地址</th>
                    <th data-option="{bind:'Phone'}">手机号码</th>
                    <th data-option="{edit:true,del:true}">操作</th>
                </tr>
            </thead>
        </table>
    </div>
</div>


<div class="row-fluid">
    <div class="span6">
        <form name="5066728374840266" id="5066728374840266" class="form-layer" style="display:none;">
            <div>
                <input type="hidden" name="ID" />
                <div class="row-fluid">
                    <div class="span6">
                        <label>用户名</label>
                        <input type="text" name="UserName" id="8278440976706824" class="span11" />
                    </div>
                    <div class="span6">
                        <label>角 色</label>
                        <select name="UserRole" id="6574967512304366" class="span11"></select>
                    </div>
                    <div class="span6">
                        <label>Email地址</label>
                        <input type="text" name="Email" id="8433491529918475" class="span11" />
                    </div>
                    <div class="span6">
                        <label>手机号码</label>
                        <input type="text" name="Phone" id="7745771669271353" class="span11" />
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

@section scripts
{
    <script type="text/javascript">
        $.post("/Biz/Admin/GetContentData", { ran: Math.random() }, function (r) {
            $(function () {
                BindToSelect(r);
                BindToDiv(r);
            });
        });

        function BindToSelect(data) {

            var sel = $("#6574967512304366");
            var items = data.URoles;
            $(items).each(function () {
                sel.append("<option value='" + this.v + "'>" + this.k + "</option>");
            });
        }

        function BindToDiv(data) {
        }

        $(function () {

            $("#5276602330016288").datagrid({ url: "/Biz/Admin/LoadAdmin", psize: 10 });


            $("#5276602330016288").parent().find(".btn-table-add").bind('click', function () {
                $("#5066728374840266").bindEntity({});
                $("#5066728374840266").open("新增", function (win) {
                    if (!tt.validateForm("5066728374840266")) {
                        return false;
                    }
                    var update = $("#5066728374840266").getContext();
                    $.post("/Biz/Admin/SaveAdmin", update, function (r) {
                        r = $.toJsResult(r);
                        if (r.ID > 0) {
                            $("#5276602330016288").datagrid("addRow", r);
                            layer.close(win);
                        }
                        else {
                            $.error("保存失败，请重试！");
                        }
                    });

                    return false;
                });
            });
            $("#5276602330016288").datagrid("onEdit", function () {
                var json = $("#5276602330016288").datagrid("getCurrData");
                $("#5066728374840266").bindEntity(json);
                $("#5066728374840266").open("编辑", function (win) {
                    if (!tt.validateForm("5066728374840266")) {
                        return false;
                    }
                    var update = $("#5066728374840266").getContext();
                    $.post("/Biz/Admin/SaveAdmin", update, function (r) {
                        r = $.toJsResult(r);
                        if (r.ID > 0) {
                            $("#5276602330016288").datagrid("updateRow", json, r);
                            layer.close(win);
                        }
                        else {
                            $.error("保存失败，请重试！");
                        }
                    });

                    return false;
                });
            });


            $("#5276602330016288").datagrid("onDelete", function () {
                $.confirm("确定要删除吗？", function () {
                    var json = $("#5276602330016288").datagrid("getCurrData");
                    $.post("/Biz/Admin/DeleteAdmin", { ID: json["ID"] }, function (r) {
                        if (r > 0) {
                            $("#5276602330016288").datagrid("removeCurrRow");
                        }
                        else {
                            $.error("删除失败，请重试！");
                        }
                    });
                });
            });

        });

        /*增加验证信息----------Start*/
        var f8278440976706824 = new tt.Field("用户名", "", "8278440976706824").setMsgId("layer-error-msg");
        tt.vf.req.add(f8278440976706824);
        new tt.LV().set(6, '++').add(f8278440976706824);

        var f6574967512304366 = new tt.Field("角 色", "", "6574967512304366").setMsgId("layer-error-msg");

        var f8433491529918475 = new tt.Field("Email地址", "", "8433491529918475").setMsgId("layer-error-msg");
        tt.vf.req.add(f8433491529918475);
        tt.vf.email.add(f8433491529918475);

        var f7745771669271353 = new tt.Field("手机号码", "", "7745771669271353").setMsgId("layer-error-msg");
        tt.vf.req.add(f7745771669271353);
        new tt.RV().set(new RegExp("^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$"), "输入数据格式错误").add(f7745771669271353);

       /*增加验证信息----------End*/
    </script>
}



