@{
    ViewBag.Title = "我的订单";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div style="padding:0px 35px;">
    <img src="~/Images/leader.gif" />
    <div style="margin-top:10px;" id="fdw-pricing-table">
        <div style="text-align: center; min-height: 100px; color: gray; padding-top: 80px;">您暂无订单信息！</div>
    </div>
    <div class="pager" style="text-align:center;padding-top:30px;"></div>
</div>

<div class="layerout" id="div_orderRemark" style="width:350px;padding-top:20px;">
    <table>
        <tr>
            <td valign="top" style="padding-top:3px;">备注信息：</td>
            <td><textarea id="remark" rows="4" style="width:250px;"></textarea></td>
        </tr>
    </table>
</div>

@section styles{
    <link href="~/Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Styles/website/orderstyles.css" rel="stylesheet" />
    <link href="~/Styles/GOMFrameWork.css" rel="stylesheet" />
    <style type="text/css">
        /*Pager*/
        .pager a {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background-color: white;
            border-right: none;
            color: #DB6D4C;
            text-decoration: none;
        }

            .pager a:hover {
                background-color: rgba(237, 237, 237, 1);
            }

        .pager .current:hover {
            background-color: #DB6D4C;
        }

        .pager a:first-child {
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }

        .pager a:last-child {
            border-right: 1px solid #ddd;
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
        }

        .pager .current {
            background-color: #DB6D4C;
            color: white;
            border-color: #DB6D4C;
            border-right: solid 1px #DB6D4C;
        }

            .pager .current + a {
                border-left: none;
            }
    </style>
}

@section scripts{
    <script src="~/Scripts/layer/layer.js"></script>
    <script type="text/javascript">
        setCurrMenu(3);

        function loadOrders(page) {
            $.post("/Member/LoadOrders", { page_g: page }, function (r) {
                var list = $.toJsResult(r.Data);
                var html = "";
                $(list).each(function (i) {
                    html += '<div class="plan plan' + (i % 4 + 1) + '"><div class="header"><p>' + this.RoomName_G + '</p></div>' +
                '<div class="price">￥' + this.AllPrice_G + ' <span>/ 共 ' + this.BookDays_G + ' 天</span></div><ul>' +
                    '<li>入住日期 <b>' + this.BookStartTime_G + '</b></li>' +
                    '<li>离开日期 <b>' + this.BookEndTime_G + '</b></li>' +
                    '<li>预定日期 <b>' + this.CreateOn_G + '</b> </li></ul>' +
                    (this.CanCancelBook_G == 0 ? '<a class="signup" style="background-color:gray;">&nbsp;退 订&nbsp;</a>' : '<a class="signup cancelBook" href="javascript:void(0)" data-id="' + this.ID + '">&nbsp;退 订&nbsp;</a> <a class="signup remarkBook" style="background-color:white;color:#404a58;border:1px solid #c0c4cd;" href="javascript:void(0)" data-id="' + this.ID + '" data-remark="' + (this.Remark ? this.Remark : '') + '">&nbsp;备 注&nbsp;</a>') +
            '</div>';
                });
                if (html.length > 0) {
                    $("#fdw-pricing-table").html(html);
                    $(".pager").html(r.pager);
                }

                $(".cancelBook").bind('click', function () {
                    var bid = $(this).attr("data-id");
                    $.confirm("确定要退订吗?", function () {
                        $.post("/Member/CancelBook", { ID: bid }, function (r) {
                            if (r > 0) {
                                $.msg("退订成功。");
                                loadOrders(1);
                            }
                            else if (r == -1) {
                                $.error("对不起，该房间不在可允许的退订时间范围内！");
                            }
                            else {
                                $.error("退订失败，请重试！");
                            }
                        });
                    });
                });
                $(".remarkBook").bind('click', function () {
                    var target = $(this);
                    var bid = target.attr("data-id");
                    $("#remark").val(target.attr("data-remark"));
                    $("#div_orderRemark").open("备注信息", function () {
                        $.post("/Member/SaveBRoomRemark", { id: bid, Remark: $("#remark").val() }, function (r) {
                            if (r > 0) {
                                target.attr("data-remark", $("#remark").val());
                                $.msg("备注信息保存成功。");
                            }
                            else {
                                $.error("备注信息保存失败，请重试！");
                            }
                        });
                    });
                });
            });
        }

        loadOrders(1);
    </script>
}